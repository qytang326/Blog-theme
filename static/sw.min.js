const CACHE_NAMESPACE="main-",CACHE="main-precache-then-runtime",PRECACHE_LIST=["./","./js/jquery.nav.min.js","./js/jquery.tagcloud.min.js","./js/gitment.min.js","./js/busuanzi.pure.min.js","./js/Quanyin-global.min.js","./js/snackbar-sw-registration.min.js","./css/Quanyin-global.min.css","./css/gitment.min.css","./img/avatar.jpg","./img/bg-home.jpg","./img/bg-offline.jpg","./img/bg-404.jpg","./img/bg-about.jpg","./img/bg-tags.jpg","./img/bg-categories.jpg","./img/post-bg-default.jpg","//cdn.bootcss.com/jquery/3.3.1/jquery.min.js","//cdn.bootcss.com/font-awesome/4.7.0/css/font-awesome.min.css","//cdn.bootcss.com/font-awesome/4.7.0/fonts/fontawesome-webfont.woff2?v=4.7.0","//cdn.bootcss.com/fastclick/1.0.6/fastclick.min.js","//cdn.bootcss.com/bootstrap/3.3.7/css/bootstrap.min.css","//cdn.bootcss.com/bootstrap/3.3.7/js/bootstrap.min.js","//cdn.bootcss.com/mathjax/2.7.4/MathJax.js?config=TeX-AMS-MML_HTMLorMML"],HOSTNAME_WHITELIST=[self.location.hostname,"qytang326.github.io","cdn.bootcss.com","cdnjs.cloudflare.com","maxcdn.bootstrapcdn.com"],DEPRECATED_CACHES=["precache-v1","runtime","main-precache-v1","main-runtime"],getCacheBustingUrl=e=>{var t=Date.now();return url=new URL(e.url),url.protocol=self.location.protocol,url.search+=(url.search?"&":"?")+"cache-bust="+t,url.href},isNavigationReq=e=>"navigate"===e.mode||"GET"===e.method&&e.headers.get("accept").includes("text/html"),endWithExtension=e=>Boolean(new URL(e.url).pathname.match(/\.\w+$/)),shouldRedirect=e=>isNavigationReq(e)&&"/"!==new URL(e.url).pathname.substr(-1)&&!endWithExtension(e),getRedirectUrl=e=>(url=new URL(e.url),url.pathname+="/",url.href);self.addEventListener("install",e=>{e.waitUntil(caches.open(CACHE).then(e=>e.addAll(PRECACHE_LIST).then(self.skipWaiting()).catch(e=>console.log(e))))}),self.addEventListener("activate",e=>{caches.keys().then(e=>Promise.all(e.filter(e=>DEPRECATED_CACHES.includes(e)).map(e=>caches.delete(e)))),console.log("service worker activated."),e.waitUntil(self.clients.claim())});var fetchHelper={fetchThenCache:function(e){const t=fetch(e,{mode:"cors",credentials:"omit"}),s=t.then(e=>e.clone());return Promise.all([s,caches.open(CACHE)]).then(([t,s])=>t.ok&&s.put(e,t)).catch(e=>{}),t},cacheFirst:function(e){return caches.match(e).then(t=>t||this.fetchThenCache(e)).catch(e=>{})}};function sendMessageToAllClients(e){self.clients.matchAll().then(t=>{t.forEach(t=>{console.log(t),t.postMessage(e)})})}function sendMessageToClientsAsync(e){setTimeout(()=>{sendMessageToAllClients(e)},1e3)}function revalidateContent(e,t){return Promise.all([e,t]).then(([e,t])=>{const s=e.headers.get("last-modified"),n=t.headers.get("last-modified");console.log(`"${s}" vs. "${n}"`),s!==n&&sendMessageToClientsAsync({command:"UPDATE_FOUND",url:t.url})}).catch(e=>console.log(e))}self.addEventListener("fetch",e=>{if(HOSTNAME_WHITELIST.indexOf(new URL(e.request.url).hostname)>-1){if(shouldRedirect(e.request))return void e.respondWith(Response.redirect(getRedirectUrl(e.request)));if(e.request.url.indexOf("ys.static")>-1)return void e.respondWith(fetchHelper.cacheFirst(e.request.url));const t=caches.match(e.request),s=fetch(getCacheBustingUrl(e.request),{cache:"no-store"}),n=s.then(e=>e.clone());e.respondWith(Promise.race([s.catch(e=>t),t]).then(e=>e||s).catch(e=>caches.match("offline.html"))),e.waitUntil(Promise.all([n,caches.open(CACHE)]).then(([t,s])=>t.ok&&s.put(e.request,t)).catch(e=>{})),isNavigationReq(e.request)&&(console.log(`fetch ${e.request.url}`),e.waitUntil(revalidateContent(t,n)))}});