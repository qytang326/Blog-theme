var CACHE_NAMESPACE="main-",CACHE=CACHE_NAMESPACE+"precache-then-runtime",PRECACHE_LIST=["./","./js/jquery.nav.min.js","./js/jquery.tagcloud.min.js","./js/gitment.min.js","./js/Quanyin-global.min.js","./css/Quanyin-global.min.css","./css/gitment.min.css","./img/avatar.jpg","./img/bg-home.jpg","./img/bg-offline.jpg","./img/bg-404.jpg","./img/bg-about.jpg","./img/bg-tags.jpg","./img/bg-categories.jpg","./img/post-bg-default.jpg","//cdn.bootcss.com/jquery/3.3.1/jquery.min.js","//cdn.bootcss.com/font-awesome/4.7.0/css/font-awesome.min.css","//cdn.bootcss.com/font-awesome/4.7.0/fonts/fontawesome-webfont.woff2?v=4.7.0","//cdn.bootcss.com/fastclick/1.0.6/fastclick.min.js","//cdn.bootcss.com/bootstrap/3.3.7/css/bootstrap.min.css","//cdn.bootcss.com/bootstrap/3.3.7/js/bootstrap.min.js","//cdn.bootcss.com/mathjax/2.7.4/MathJax.js?config=TeX-AMS-MML_HTMLorMML"],HOSTNAME_WHITELIST=[self.location.hostname,"qytang326.github.io","cdn.bootcss.com","cdnjs.cloudflare.com","maxcdn.bootstrapcdn.com"],DEPRECATED_CACHES=["precache-v1","runtime","main-precache-v1","main-runtime"],getCacheBustingUrl=function(e){var t=Date.now();return url=new URL(e.url),url.protocol=self.location.protocol,url.search+=(url.search?"&":"?")+"cache-bust="+t,url.href},isNavigationReq=function(e){return"navigate"===e.mode||"GET"===e.method&&e.headers.get("accept").includes("text/html")},endWithExtension=function(e){return Boolean(new URL(e.url).pathname.match(/\.\w+$/))},shouldRedirect=function(e){return isNavigationReq(e)&&"/"!==new URL(e.url).pathname.substr(-1)&&!endWithExtension(e)},getRedirectUrl=function(e){return url=new URL(e.url),url.pathname+="/",url.href};self.addEventListener("install",function(e){e.waitUntil(caches.open(CACHE).then(function(e){return e.addAll(PRECACHE_LIST).then(self.skipWaiting()).catch(function(e){return console.log(e)})}))}),self.addEventListener("activate",function(e){caches.keys().then(function(e){return Promise.all(e.filter(function(e){return DEPRECATED_CACHES.includes(e)}).map(function(e){return caches.delete(e)}))}),console.log("service worker activated."),e.waitUntil(self.clients.claim())});var fetchHelper={fetchThenCache:function(e){var t=fetch(e,{mode:"cors",credentials:"omit"}),n=t.then(function(e){return e.clone()});return Promise.all([n,caches.open(CACHE)]).then(function(t){var n=_slicedToArray(t,2),c=n[0],o=n[1];return c.ok&&o.put(e,c)}).catch(function(e){}),t},cacheFirst:function(e){var t=this;return caches.match(e).then(function(n){return n||t.fetchThenCache(e)}).catch(function(e){})}};function sendMessageToAllClients(e){self.clients.matchAll().then(function(t){t.forEach(function(t){console.log(t),t.postMessage(e)})})}function sendMessageToClientsAsync(e){setTimeout(function(){sendMessageToAllClients(e)},1e3)}function revalidateContent(e,t){return Promise.all([e,t]).then(function(e){var t=_slicedToArray(e,2),n=t[0],c=t[1],o=n.headers.get("last-modified"),s=c.headers.get("last-modified");console.log('"'+o+'" vs. "'+s+'"'),o!==s&&sendMessageToClientsAsync({command:"UPDATE_FOUND",url:c.url})}).catch(function(e){return console.log(e)})}self.addEventListener("fetch",function(e){if(HOSTNAME_WHITELIST.indexOf(new URL(e.request.url).hostname)>-1){if(shouldRedirect(e.request))return void e.respondWith(Response.redirect(getRedirectUrl(e.request)));if(e.request.url.indexOf("ys.static")>-1)return void e.respondWith(fetchHelper.cacheFirst(e.request.url));var t=caches.match(e.request),n=fetch(getCacheBustingUrl(e.request),{cache:"no-store"}),c=n.then(function(e){return e.clone()});e.respondWith(Promise.race([n.catch(function(e){return t}),t]).then(function(e){return e||n}).catch(function(e){return caches.match("offline.html")})),e.waitUntil(Promise.all([c,caches.open(CACHE)]).then(function(t){var n=_slicedToArray(t,2),c=n[0],o=n[1];return c.ok&&o.put(e.request,c)}).catch(function(e){})),isNavigationReq(e.request)&&(console.log("fetch "+e.request.url),e.waitUntil(revalidateContent(t,c)))}});